<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:body>
	<ui:composition template="template.xhtml">
		<ui:define name="content">

      <h:panelGroup rendered="#{user.permissionId == 4}">
        <meta http-equiv="REFRESH" content="0;url=login.xhtml" />
      </h:panelGroup>

			<h2>Account for user: #{user.userName}</h2>

      <h:form id="accountForm0" rendered="#{user.permissionId le 3}">
        <h4>Brokers in Tournaments</h4>
        <h:dataTable border="1"
                     style="border:1px solid black;border-collapse:collapse;text-align:center"
                     value="#{actionAccount.brokers}" var="broker">
          <h:column>
            <f:facet name="header">Broker Name</f:facet>
            <h:outputText value="#{broker.brokerName}" />
          </h:column>

          <h:column>
            <f:facet name="header">Tournaments</f:facet>
            <h:outputText value="#{broker.getRegisteredString()}" />
          </h:column>

          <h:column>
            <f:facet name="header">Available</f:facet>
            <h:selectOneMenu value="#{broker.selectedTourneyRegister}"
                             styleClass="smallButton">
              <f:selectItems value="#{actionAccount.getAvailableTournaments(broker)}"
                             var="t" itemValue="#{t.tournamentId}"
                             itemLabel="#{t.tournamentName}"
                             rendered="{(t.maxBrokers != t.numberRegistered)}"/>
            </h:selectOneMenu>
          </h:column>

          <h:column>
            <f:facet name="header">Register</f:facet>
            <h:commandButton value="register" styleClass="smallButton"
                             action="#{actionAccount.register(broker)}"/>
          </h:column>
        </h:dataTable>
        <h:message for="accountForm0" />
      </h:form>

      <h:form id="accountForm1" rendered="#{user.permissionId le 3}">
        <br/>
        <h4>Manage Brokers</h4>
        <h:dataTable border="1"
                     style="border:1px solid black;border-collapse:collapse;text-align:center"
                     value="#{actionAccount.brokers}" var="broker">
          <h:column>
            <f:facet name="header">Broker Name</f:facet>
            <h:outputText value="#{broker.brokerName}"
                          rendered="#{!broker.edit}" />
            <h:inputText value="#{broker.newName}"
                         rendered="#{broker.edit}" maxlength="45"/>
          </h:column>

          <h:column>
            <f:facet name="header">Broker Id</f:facet>
            <h:outputText value="#{broker.brokerId}" />
          </h:column>

          <h:column>
            <f:facet name="header">Broker Auth Token</f:facet>
            <h:outputText value="#{broker.brokerAuth}"
                          rendered="#{!broker.edit}" />
            <h:inputText value="#{broker.newAuth}"
                         rendered="#{broker.edit}" maxlength="32"/>
          </h:column>

          <h:column>
            <f:facet name="header">Short Description</f:facet>
            <h:outputText value="#{broker.shortDescription}"
                          rendered="#{!broker.edit}" />
            <h:inputText value="#{broker.newShort}"
                         rendered="#{broker.edit}" maxlength="256"/>
          </h:column>

          <h:column>
            <f:facet name="header">Action</f:facet>
            <h:commandButton value="edit" styleClass="smallButton"
                             action="#{actionAccount.editBroker(broker)}"
                             rendered="#{!broker.edit}" />
            <h:commandButton value="delete" styleClass="smallButton"
                             action="#{actionAccount.deleteBroker(broker)}"
                             rendered="#{!broker.edit}" />
            <h:commandButton value="save" styleClass="smallButton"
                             action="#{actionAccount.updateBroker(broker)}"
                             rendered="#{broker.edit}" />
            <h:commandButton value="cancel" styleClass="smallButton"
                             action="#{actionAccount.cancelBroker(broker)}"
                             rendered="#{broker.edit}" />
          </h:column>
        </h:dataTable>
        <h:message for="accountForm1" />
      </h:form>

      <h:form id="accountForm2" rendered="#{user.permissionId le 3}">
        <br/>
        <h4>Add Broker Name/Description</h4>
        <h:panelGrid columns="1">
          <h:inputText value="#{actionAccount.brokerName}" maxlength="45"/>
          <h:inputTextarea value="#{actionAccount.brokerShort}"
                           maxlength="256"/>
          <h:commandButton value="Add Broker"
                           action="#{actionAccount.addBroker}" />
          <br/>
        </h:panelGrid>
        <h:message for="accountForm2" />
      </h:form>

			<h:form rendered="#{user.permissionId gt 3}">
        <h3>Insufficient Permissions, redirecting in 10 seconds</h3>
        <meta http-equiv="REFRESH" content="10;url=login.xhtml" />
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>