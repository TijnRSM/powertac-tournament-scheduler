<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk">

<h:body>
  <ui:composition template="template.xhtml">
		<ui:define name="content">
      <script type="text/javascript" src="tournamentManager.js"></script>

			<h:form rendered="#{user.permissions le 0}" id="removeTournament">
				<h2>Tournament Manager</h2>

        <h3 class="withButton">Pending/Running Tournaments</h3><h:commandButton value="Refresh" action="#{actionTournament.refresh}"/>
				<t:dataTable id="datatourneys" border="1" sortable="false"
					sortColumn="#{actionTournament.sortColumn}"
					sortAscending="#{actionTournament.sortAscending}" preserveSort="true"
					style="border:1px solid black;border-collapse:collapse;text-align:center"
					value="#{actionTournament.tournamentList}" var="t">

					<t:column defaultSorted="true" sortable="true">
						<f:facet name="header">
							<h:outputText value="ID" />
						</f:facet>
						<h:outputText value="#{t.tournamentId}" />
					</t:column>

					<t:column sortable="true">
						<f:facet name="header">
							<h:outputText value="Name" />
						</f:facet>
						<h:outputText value="#{t.tournamentName}" />
					</t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Status" />
            </f:facet>
            <h:outputText value="#{t.status}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Type" />
            </f:facet>
            <h:outputText value="Multi" rendered="#{t.type == 'MULTI_GAME'}"/>
            <h:outputText value="Single" rendered="#{t.type == 'SINGLE_GAME'}"/>
          </t:column>

					<t:column>
						<f:facet name="header">
							<h:outputText value="Start Time" />
						</f:facet>
            <h:outputText value="#{t.toUTCStartTime()}" />
					</t:column>

					<t:column sortable="true">
						<f:facet name="header">
							<h:outputText value="Max Bro" />
						</f:facet>
						<h:outputText value="#{t.maxBrokers}" rendered="#{t.maxBrokers != -1}" />
            <h:outputText value="n.a." rendered="#{t.maxBrokers == -1}" />
					</t:column>

					<t:column sortable="true">
						<f:facet name="header">
							<h:outputText value="Reg Bro" />
						</f:facet>
						<h:outputText value="#{t.numberRegistered}" />
					</t:column>

					<t:column>
						<f:facet name="header">
							<h:outputText value="Pom" />
						</f:facet>
						<a href="pom.jsp?pomId=#{t.pomId}">
              <h:outputText value="#{t.pomId}" />
            </a>
					</t:column>

          <t:column>
            <h:commandButton value="Delete"
                action="#{actionTournament.removeTournament(t)}"
                rendered="#{t.tournamentName.toLowerCase().contains('test')}"
                onclick="return confirmAlert('Are you sure you want to delete this tournament?');"/>
          </t:column>
				</t:dataTable>
        <h:message for="removeTournament" />
			</h:form>

			<h:form enctype="multipart/form-data" rendered="#{user.permissions le 0}"
          id="saveTournament">
				<h3>Create Tournament</h3>
        <h:message for="saveTournament" />

				<h:panelGrid columns="2" id="tournamentTable">
					<h:outputText value="Tournament Name:" />
					<h:panelGroup>
						<h:inputText value="#{actionTournament.tournamentName}" />
					</h:panelGroup>

					<h:outputText value="Tournament Type:" />
					<h:panelGroup>
						<h:selectOneMenu value="#{actionTournament.type}"
                actionListener="#{actionTournament.formType}"
                onchange="typeSelected()">
							<f:selectItems value="#{actionTournament.types}" var="t"
								itemValues="#{t.ordinal}" itemLabel="#{t.label}" />
						</h:selectOneMenu>
					</h:panelGroup>

          <h:outputText value="Max Brokers" />
          <h:panelGroup>
            <h:inputText id="maxBrokers" value="#{actionTournament.maxBrokers}"
                         onchange="showGamesCount()" onkeyup="showGamesCount()" />
            <span id="totalGames"/>
          </h:panelGroup>

          <h:outputText value="Max Agents" />
          <h:panelGroup>
            <h:inputText value="#{actionTournament.maxAgents}"/>
          </h:panelGroup>

					<h:outputText value="Game 1 Size:" />
					<h:panelGroup>
						<h:inputText id="gameSize1" value="#{actionTournament.size1}"
                         onchange="showGamesCount()" onkeyup="showGamesCount()"/>
            <span id="total1"/>
					</h:panelGroup>

					<h:outputText value="Game 2 Size:" />
					<h:panelGroup>
						<h:inputText id="gameSize2" value="#{actionTournament.size2}"
                         onchange="showGamesCount()" onkeyup="showGamesCount()"/>
            <span id="total2"/>
					</h:panelGroup>

					<h:outputText value="Game 3 Size:" />
					<h:panelGroup>
						<h:inputText id="gameSize3" value="#{actionTournament.size3}"
                         onchange="showGamesCount()" onkeyup="showGamesCount()"/>
            <span id="total3"/>
					</h:panelGroup>

					<h:outputText value="StartTime UTC" />
					<h:panelGroup>
						<t:inputDate value="#{actionTournament.startTime}" timeZone="UTC" type="both"
							ampm="false" forceId="true" />
					</h:panelGroup>

					<h:outputText value="Date from: " />
					<h:panelGroup>
						<t:inputDate value="#{actionTournament.fromTime}" type="both"
							ampm="false" forceId="true" /><br/>
					</h:panelGroup>

          <h:outputText value="Date to:" />
          <h:panelGroup>
            <t:inputDate value="#{actionTournament.toTime}" type="both"
              ampm="false" forceId="true" />
          </h:panelGroup>

          <h:outputText value="Select Pom File:" />
          <h:panelGroup>
            <h:selectOneMenu id="poms" value="#{actionTournament.selectedPom}" required="true">
              <f:selectItems value="#{actionTournament.pomList}" var="p"
                             itemValue="#{p.pomId}" itemLabel="#{p.name}" />
            </h:selectOneMenu>
          </h:panelGroup>

					<h:outputText value="Locations:" />
					<h:panelGroup>
						<h:selectManyCheckbox id="locations" value="#{actionTournament.locations}" required="true">
							<f:selectItems value="#{actionTournament.locationList}" var="L"
								itemValue="#{L.name}" itemLabel="#{L.name}" />
						</h:selectManyCheckbox>
					</h:panelGroup>

					<h:outputText value="Add Tournament" />
					<h:panelGroup>
						<h:commandButton value="Submit"
							action="#{actionTournament.createTournament}" />
            <br/>
					</h:panelGroup>
				</h:panelGrid>
			</h:form>

      <br/>
      <h4>If the tournament name contains 'test' (any case), short games will be created</h4>
      <h4>It also allows deletion of the tournament</h4>

			<h:form rendered="#{user.permissions gt 0}">
				<h2>Insufficient Permissions</h2>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>