<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk">

<h:body>
  <ui:composition template="template.xhtml">
    <ui:define name="content">
      <h2>Overview</h2>

      <h:form rendered="#{user.permissionId le 0}">
        <h3 class="withButton">Registered Brokers</h3><h:commandButton value="Refresh" action="#{actionOverview.refresh}"/>
        <t:dataTable id="databrokers" border="1" sortable="false"
                     sortColumn="#{actionOverview.sortColumnBrokers}"
                     sortAscending="#{actionOverview.sortAscendingBrokers}" preserveSort="true"
                     style="border:1px solid black;border-collapse:collapse;text-align:center"
                     value="#{actionOverview.brokerList}" var="broker">

          <t:column defaultSorted="true" sortable="true">
            <f:facet name="header">
              <h:outputText value="ID" />
            </f:facet>
            <h:outputText value="#{broker.brokerId}" />
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Name" />
            </f:facet>
            <h:outputText value="#{broker.brokerName}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="User" />
            </f:facet>
            <h:outputText value="#{broker.user.userName}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Tournaments" />
            </f:facet>
            <h:outputText value="#{broker.getRegisteredString()}" />
          </t:column>
        </t:dataTable>
      </h:form>

      <h:form rendered="#{user.permissionId le 0}">
        <h3 class="withButton">Pending/Running Tournaments</h3><h:commandButton value="Refresh" action="#{actionOverview.refresh}"/>
        <t:dataTable id="datatourneys" border="1" sortable="false"
                     sortColumn="#{actionOverview.sortColumnTournaments}"
                     sortAscending="#{actionOverview.sortAscendingTournaments}" preserveSort="true"
                     style="border:1px solid black;border-collapse:collapse;text-align:center"
                     value="#{actionOverview.notCompleteTournamentList}" var="t">

          <t:column defaultSorted="true" sortable="true">
            <f:facet name="header">
              <h:outputText value="ID" />
            </f:facet>
            <h:outputText value="#{t.tournamentId}" />
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Name" />
            </f:facet>
            <a href="tournament.xhtml?tournamentId=#{t.tournamentId}">
              <h:outputText value="#{t.tournamentName}" />
            </a>
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Status" />
            </f:facet>
            <h:outputText value="#{t.status}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Type" />
            </f:facet>
            <h:outputText value="Multi" rendered="#{t.type == 'MULTI_GAME'}"/>
            <h:outputText value="Single" rendered="#{t.type == 'SINGLE_GAME'}"/>
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Start Time" />
            </f:facet>
            <h:outputText value="#{t.startTimeUTC()}" />
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Max Bro" />
            </f:facet>
            <h:outputText value="#{t.maxBrokers}" />
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Reg Bro" />
            </f:facet>
            <h:outputText value="#{t.brokerMap.size()}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Pom" />
            </f:facet>
            <a href="pom.jsp?pomId=#{t.pomId}">
              <h:outputText value="#{t.pomId}" />
            </a>
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Actions" />
            </f:facet>
            <h:commandButton value="Now" action="#{actionOverview.startNow(t)}"
                             onclick="return confirmAlert('This will start all the games in this tournament now. Proceed?');"
                             rendered="#{!t.isStarted()}"/>
          </t:column>
        </t:dataTable>
      </h:form>

      <h:form rendered="#{user.permissionId le 0}" id="gamesForm">
        <h3 class="withButton">Pending/Running Games</h3><h:commandButton value="Refresh" action="#{actionOverview.refresh}"/>
        <t:dataTable id="datagames" border="1" sortable="false"
                     sortColumn="#{actionOverview.sortColumnGames}"
                     sortAscending="#{actionOverview.sortAscendingGames}" preserveSort="true"
                     style="border:1px solid black;border-collapse:collapse;text-align:center"
                     value="#{actionOverview.notCompleteGamesList}" var="g">
          <t:column defaultSorted="true" sortable="true">
            <f:facet name="header">
              <h:outputText value="ID" />
            </f:facet>
            <h:outputText value="#{g.gameId}" />
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Name" />
            </f:facet>
            <a href="game.xhtml?gameId=#{g.gameId}">
              <h:outputText value="#{g.gameName}" />
            </a>
          </t:column>

          <t:column sortable="true">
            <f:facet name="header">
              <h:outputText value="Status" />
            </f:facet>
            <h:outputText value="#{g.status}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Start Time" />
            </f:facet>
            <h:outputText value="#{g.startTimeUTC()}" />
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Props" />
            </f:facet>
            <a href="properties.jsp?gameId=#{g.gameId}">Props</a>
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Boot" />
            </f:facet>
            <h:outputText value="Not avail." rendered="#{!g.hasBootstrap()}"/>
            <h:panelGroup rendered="#{g.hasBootstrap()}" >
              <a href="serverInterface.jsp?action=boot&amp;gameId=#{g.gameId}">Boot</a>
            </h:panelGroup>
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Viz" />
            </f:facet>
            <h:outputText value="Not avail." rendered="#{!g.isRunning()}"/>
            <h:panelGroup rendered="#{g.isRunning()}" >
              <a href="http://#{g.machine.vizUrl}" target="_blank">Viz</a>
            </h:panelGroup>
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Jenkins" />
            </f:facet>
            <h:outputText value="Not avail." rendered="#{g.machine == null}"/>
            <h:panelGroup rendered="#{g.machine != null}" >
              <a href="#{g.jenkinsMachineUrl()}" target="_blank">Jenkins</a>
            </h:panelGroup>
          </t:column>

          <t:column>
            <f:facet name="header">
              <h:outputText value="Actions" />
            </f:facet>
            <h:panelGroup>
              <h:commandButton value="Stop" action="#{actionOverview.stopGame(g)}"
                onclick="return confirmAlert('Are you sure you want to stop this game?');"
                rendered="#{g.machine != null}" />
              <h:commandButton value="Restart" action="#{actionOverview.restartGame(g)}"
                               rendered="#{g.gameFailed()}" />
            </h:panelGroup>
          </t:column>
        </t:dataTable>

        <h:messages for="gamesForm" />
      </h:form>

      <h:form rendered="#{user.permissionId gt 0}">
        <h2>Insufficient Permissions</h2>
      </h:form>

    </ui:define>
  </ui:composition>
</h:body>
</html>